
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="">

    <title>Starter Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/index.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/request.js"></script>

    <!-- Josh map stuff -->
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      #map-canvas { height: 500px;
                    width: 500px; }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCO4GPOyB-CGxEnbqT-KAJHD9VUYjPCPVE&sensor=true">
    </script>
    <script type="text/javascript">
         // creates geocoder so that you can get locaiton from address.
      geocoder = new google.maps.Geocoder();
      geocoder.geocode({address: "4340 N Knoll, Fresno, CA"}, function(results) {
        //alert("Latitude for " + results[0].formatted_address + " is " + results[0].geometry.location.lat());
        lat = results[0].geometry.location.lat();
        lng = results[0].geometry.location.lng();
        //alert(lat + " lng " + lng);
      });

      var map;
      function initialize() {
        var mapOptions = {
          //center: new google.maps.LatLng(47.6559, -122.3031),
          zoom: 18,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById("map-canvas"),
            mapOptions);

        if(navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position){
            var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            //alert(pos.lat() + " " + pos.lng());
            var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
            var marker = new Array();
            for(var i = 0; i < 2; i++) {
              /*if(i == 0) {
                marker[0] = new google.maps.Marker({
                  position: new google.maps.LatLng(pos.lat(), pos.lng()),
                  map: map,
                  icon : iconBase + 'schools_maps.png'
                });
              }else if(i == 1) {
                marker[1] = new google.maps.Marker({
                  position: new google.maps.LatLng(54, -122),
                  map: map,
                  icon : iconBase + 'schools_maps.png'
                });
              }*/

              marker[0] = new google.maps.Marker({
                  position: new google.maps.LatLng(pos.lat(), pos.lng()),
                  map: map,
                  icon : iconBase + 'schools_maps.png'
                });
              var lat = 47.6559;
              var lng = -122.3031;
              var marker2 = new google.maps.Marker({
                  position: new google.maps.LatLng(lat, lng),
                  map: map
                });
              //alert(i);
            }
      




            map.setCenter(pos);
          }, function(){
            //handleNoGeolocation(true);
          });
        }
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>        
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link type="text/css" href="css/bootstrap.min.css" />
        <link type="text/css" href="css/bootstrap-timepicker.min.css" />
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src="js/bootstrap-timepicker.min.js"></script>

  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Lunch with Friends</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">
    <div id="pagewrap">
    <header>
      Lunchify
    </header>
    <div id="login">
    <span id="button">
        <div class="input-append bootstrap-timepicker">
            <input id="timepicker1" type="text" class="input-small">
            <span class="add-on"><i class="icon-time"></i></span>
        </div>
 
        <script type="text/javascript">
            $('#timepicker1').timepicker();
        </script>
    </span>
    </div>
    <div id="mapwrap">
      <div id="map-canvas"></div>
      <div id="friendlist">
        <ul id="list">
          <li>friend1</li>
          <li>friend2</li>
          <li>friend3</li>
        </ul>
      </div>
    </div>
    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="../../dist/js/bootstrap.min.js"></script>
    <script>

        request("get-friends", {}, function(data) {
    $.each(data, function(k, v) {
      $("#list").append('<li><img src="' + v.dp + '"> ' + v.name + '</li>');
    });
  });
            /*request("search-restaurants", {loc_lat: lat, loc_lgn: lgn, q: query}, function(data) {
                for(var building in data) {
                    building.
                }
            });*/
            var marker = new Array();
            var poopdata = new Array();
            var poopdata2 = new Array();
            var count = 0;
            var infowindow =  new google.maps.InfoWindow({
              content: "fsdfsd"
            });
                        
            $.getJSON("store.json", function(data){
                $.each(data.data.businesses, function(k, v) {
                    console.log(v.location.display_address[0]);
                    console.log(v.location.display_address[3]);
                    console.log(v.snippet_image_url);
                    poopdata[v.location.display_address[0]] = [{"image" : v.snippet_image_url,
                                                               "name" : v.name,
                                                               "ratingImage" :v.rating_img_url,
                                                               "reviewCount" : v.review_count,
                                                               "address1" : v.location.display_address[0],
                                                               "address2" : v.location.display_address[3]}];
                                                               console.log(v.rating_img_url);
                    //console.log("reading data! " + poopdata[v.location.display_address[0]][0].name);
                    //infowinodw.setContent(v.location.display_address[0]);
                    if(typeof(v.location.display_address[3]) !== "undefined") {
                      geocoder = new google.maps.Geocoder();
                      //1st asynchronous
                      geocoder.geocode({address: v.location.display_address[0] + ", " + v.location.display_address[3]}, function(results) {
                        console.log(results[0]);
                        lat = results[0].geometry.location.lat();
                        lng = results[0].geometry.location.lng();
                        console.log(results[0].address_components[0].short_name);

                        poopdata2[lat + ":" + lng] = poopdata[results[0].address_components[0].short_name + " " + results[0].address_components[1].short_name]
                        //Creates the markers
                        marker[lat + ":" + lng] = new google.maps.Marker({
                          position: new google.maps.LatLng(lat, lng),
                          map: map
                        }); //end marker

                        //2nd asynchronous
                        google.maps.event.addListener(marker[lat + ":" + lng], "click", function(poop1) {
                          console.log(poop1);
                          console.log("infowindow " + poopdata2[poop1.latLng.k + ":" + poop1.latLng.A])
                           poop = marker[poop1.latLng.k + ":" + poop1.latLng.A];
                          infowindow.setContent(
                            '<p><h1>' + poopdata2[poop1.latLng.k + ":" + poop1.latLng.A][0].name + '</h1></p>' 
                            + '<img src="' + poopdata2[poop1.latLng.k + ":" + poop1.latLng.A][0].ratingImage + '">'
                            + poopdata2[poop1.latLng.k + ":" + poop1.latLng.A][0].reviewCount 
                            + '<p>' + poopdata2[poop1.latLng.k + ":" + poop1.latLng.A][0].address1 + '</p>'
                            + '<p>' + poopdata2[poop1.latLng.k + ":" + poop1.latLng.A][0].address2 + '</p>'
                            + '<img src="' + poopdata2[poop1.latLng.k + ":" + poop1.latLng.A][0].image + '">');
                          infowindow.close();
                          infowindow.open(map, poop);
                        });
                      }); //geocoder

                      count++;
                   } // end if statement
                }); //end for each
            }); // end json
map.cl
    </script>
  </body>
</html>
